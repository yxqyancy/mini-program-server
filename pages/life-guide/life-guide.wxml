<!--life-guide.wxml-->
<view class="container ocean-bg">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">ğŸ  ç”Ÿæ´»æŒ‡å—</text>
    <view class="header-buttons">
      <button class="save-btn" bindtap="confirmSave" wx:if="{{isEditMode && hasUnsavedChanges}}">
        ğŸ’¾ ä¿å­˜
      </button>
      <button class="edit-btn" bindtap="toggleEditMode">
        {{isEditMode ? 'å®Œæˆç¼–è¾‘' : 'ç¼–è¾‘'}}
      </button>
    </view>
  </view>

  <!-- ç¾é£Ÿ -->
  <view class="section card">
    <view class="section-header">
      <text class="section-icon">ğŸ½ï¸</text>
      <text class="section-title">ç¾é£Ÿ</text>
      <button class="add-food-btn" bindtap="addFood" wx:if="{{isEditMode}}">
        â• æ·»åŠ ç¾é£Ÿ
      </button>
    </view>
    
    <!-- ç¾é£Ÿå±•ç¤ºåŒºåŸŸ -->
    <view class="foods-container" wx:if="{{!isEditMode}}">
      <view class="foods-grid">
        <view class="food-card" wx:for="{{lifeGuide.foods}}" wx:key="index">
          <view class="food-info">
            <text class="food-name">{{item.name}}</text>
            <text class="food-location">{{item.location}}</text>
            <text class="food-price">{{item.price}}</text>
            <view class="food-image" wx:if="{{item.image}}">
              <image src="{{item.image}}" mode="aspectFill" bindtap="previewImage" data-src="{{item.image}}"/>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- ç¾é£Ÿç¼–è¾‘åŒºåŸŸ -->
    <view class="foods-edit" wx:if="{{isEditMode}}">
      <view class="edit-notice">
        <text>å½“å‰ç¼–è¾‘æ¨¡å¼ï¼Œæ€»è®¡ {{lifeGuide.foods.length}} ä¸ªç¾é£Ÿ</text>
      </view>
      
      <view class="foods-grid-edit">
        <view class="food-card-edit" wx:for="{{lifeGuide.foods}}" wx:key="index">
          <view class="food-info-edit">
            <input class="food-name-input" 
                   value="{{item.name}}" 
                   bindinput="updateFoodName" 
                   data-index="{{index}}"
                   placeholder="ç¾é£Ÿåç§°"/>
            <input class="food-location-input" 
                   value="{{item.location}}" 
                   bindinput="updateFoodLocation" 
                   data-index="{{index}}"
                   placeholder="ä½ç½®"/>
            <input class="food-price-input" 
                   value="{{item.price}}" 
                   bindinput="updateFoodPrice" 
                   data-index="{{index}}"
                   placeholder="ä»·æ ¼"/>
            <view class="image-upload">
              <image wx:if="{{item.image}}" src="{{item.image}}" mode="aspectFill" class="uploaded-image"/>
              <button class="btn-upload" bindtap="chooseImage" data-section="foods" data-index="{{index}}">
                {{item.image ? 'æ›´æ¢å›¾ç‰‡' : 'ä¸Šä¼ å›¾ç‰‡'}}
              </button>
              <button wx:if="{{item.image}}" class="btn-remove-image" bindtap="removeImage" data-section="foods" data-index="{{index}}">åˆ é™¤å›¾ç‰‡</button>
            </view>
          </view>
          <button class="remove-food-btn" 
                  bindtap="removeFood" 
                  data-index="{{index}}">
            ğŸ—‘ï¸
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- å›¢å»º -->
  <view class="section card">
    <view class="section-header">
      <text class="section-icon">ğŸ‰</text>
      <text class="section-title">å›¢å»º</text>
      <button class="add-team-building-btn" bindtap="addTeamBuilding" wx:if="{{isEditMode}}">
        â• æ·»åŠ å›¢å»º
      </button>
    </view>
    
    <!-- å›¢å»ºå±•ç¤ºåŒºåŸŸ -->
    <view class="team-buildings-container" wx:if="{{!isEditMode}}">
      <view class="team-buildings-grid">
        <view class="team-building-card" wx:for="{{lifeGuide.teamBuildings}}" wx:key="index">
          <view class="team-building-info">
            <text class="team-building-name">{{item.name}}</text>
            <text class="team-building-desc">{{item.description}}</text>
            <text class="team-building-time">{{item.time}}</text>
            <text class="team-building-location">{{item.location}}</text>
            <view class="team-building-image" wx:if="{{item.image}}">
              <image src="{{item.image}}" mode="aspectFill" bindtap="previewImage" data-src="{{item.image}}"/>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- å›¢å»ºç¼–è¾‘åŒºåŸŸ -->
    <view class="team-buildings-edit" wx:if="{{isEditMode}}">
      <view class="edit-notice">
        <text>å½“å‰ç¼–è¾‘æ¨¡å¼ï¼Œæ€»è®¡ {{lifeGuide.teamBuildings.length}} ä¸ªå›¢å»ºæ´»åŠ¨</text>
      </view>
      
      <view class="team-buildings-grid-edit">
        <view class="team-building-card-edit" wx:for="{{lifeGuide.teamBuildings}}" wx:key="index">
          <view class="team-building-info-edit">
            <input class="team-building-name-input" 
                   value="{{item.name}}" 
                   bindinput="updateTeamBuildingName" 
                   data-index="{{index}}"
                   placeholder="å›¢å»ºåç§°"/>
            <textarea class="team-building-desc-input" 
                      value="{{item.description}}" 
                      bindinput="updateTeamBuildingDesc" 
                      data-index="{{index}}"
                      placeholder="å›¢å»ºæè¿°"/>
            <input class="team-building-time-input" 
                   value="{{item.time}}" 
                   bindinput="updateTeamBuildingTime" 
                   data-index="{{index}}"
                   placeholder="æ—¶é—´"/>
            <input class="team-building-location-input" 
                   value="{{item.location}}" 
                   bindinput="updateTeamBuildingLocation" 
                   data-index="{{index}}"
                   placeholder="åœ°ç‚¹"/>
            <view class="image-upload">
              <image wx:if="{{item.image}}" src="{{item.image}}" mode="aspectFill" class="uploaded-image"/>
              <button class="btn-upload" bindtap="chooseImage" data-section="teamBuildings" data-index="{{index}}">
                {{item.image ? 'æ›´æ¢å›¾ç‰‡' : 'ä¸Šä¼ å›¾ç‰‡'}}
              </button>
              <button wx:if="{{item.image}}" class="btn-remove-image" bindtap="removeImage" data-section="teamBuildings" data-index="{{index}}">åˆ é™¤å›¾ç‰‡</button>
            </view>
          </view>
          <button class="remove-team-building-btn" 
                  bindtap="removeTeamBuilding" 
                  data-index="{{index}}">
            ğŸ—‘ï¸
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- èµšé’± -->
  <view class="section card">
    <view class="section-header">
      <text class="section-icon">ğŸ’°</text>
      <text class="section-title">èµšé’±</text>
      <button class="add-money-btn" bindtap="addMoney" wx:if="{{isEditMode}}">
        â• æ·»åŠ å·¥ä½œ
      </button>
    </view>
    
    <!-- èµšé’±å±•ç¤ºåŒºåŸŸ -->
    <view class="moneys-container" wx:if="{{!isEditMode}}">
      <view class="moneys-grid">
        <view class="money-card" wx:for="{{lifeGuide.moneys}}" wx:key="index">
          <view class="money-info">
            <text class="money-name">{{item.name}}</text>
            <text class="money-desc">{{item.description}}</text>
            <text class="money-salary">{{item.salary}}</text>
            <view class="money-image" wx:if="{{item.image}}">
              <image src="{{item.image}}" mode="aspectFill" bindtap="previewImage" data-src="{{item.image}}"/>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- èµšé’±ç¼–è¾‘åŒºåŸŸ -->
    <view class="moneys-edit" wx:if="{{isEditMode}}">
      <view class="edit-notice">
        <text>å½“å‰ç¼–è¾‘æ¨¡å¼ï¼Œæ€»è®¡ {{lifeGuide.moneys.length}} ä¸ªå·¥ä½œ</text>
      </view>
      
      <view class="moneys-grid-edit">
        <view class="money-card-edit" wx:for="{{lifeGuide.moneys}}" wx:key="index">
          <view class="money-info-edit">
            <input class="money-name-input" 
                   value="{{item.name}}" 
                   bindinput="updateMoneyName" 
                   data-index="{{index}}"
                   placeholder="å·¥ä½œåç§°"/>
            <textarea class="money-desc-input" 
                      value="{{item.description}}" 
                      bindinput="updateMoneyDesc" 
                      data-index="{{index}}"
                      placeholder="å·¥ä½œæè¿°"/>
            <input class="money-salary-input" 
                   value="{{item.salary}}" 
                   bindinput="updateMoneySalary" 
                   data-index="{{index}}"
                   placeholder="è–ªèµ„"/>
            <view class="image-upload">
              <image wx:if="{{item.image}}" src="{{item.image}}" mode="aspectFill" class="uploaded-image"/>
              <button class="btn-upload" bindtap="chooseImage" data-section="moneys" data-index="{{index}}">
                {{item.image ? 'æ›´æ¢å›¾ç‰‡' : 'ä¸Šä¼ å›¾ç‰‡'}}
              </button>
              <button wx:if="{{item.image}}" class="btn-remove-image" bindtap="removeImage" data-section="moneys" data-index="{{index}}">åˆ é™¤å›¾ç‰‡</button>
            </view>
          </view>
          <button class="remove-money-btn" 
                  bindtap="removeMoney" 
                  data-index="{{index}}">
            ğŸ—‘ï¸
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- æ ¡å›­åœ°å›¾ -->
  <view class="section card">
    <view class="section-header">
      <text class="section-icon">ğŸ—ºï¸</text>
      <text class="section-title">æ ¡å›­åœ°å›¾</text>
      <button class="add-map-btn" bindtap="addMap" wx:if="{{isEditMode}}">
        â• æ·»åŠ åœ°å›¾
      </button>
    </view>
    
    <!-- æ ¡å›­åœ°å›¾å±•ç¤ºåŒºåŸŸ -->
    <view class="maps-container" wx:if="{{!isEditMode}}">
      <view class="maps-grid">
        <view class="map-card" wx:for="{{lifeGuide.maps}}" wx:key="index">
          <view class="map-info">
            <text class="map-name">{{item.name}}</text>
            <view class="map-image" wx:if="{{item.image}}">
              <image src="{{item.image}}" mode="aspectFill" bindtap="previewImage" data-src="{{item.image}}"/>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- æ ¡å›­åœ°å›¾ç¼–è¾‘åŒºåŸŸ -->
    <view class="maps-edit" wx:if="{{isEditMode}}">
      <view class="edit-notice">
        <text>å½“å‰ç¼–è¾‘æ¨¡å¼ï¼Œæ€»è®¡ {{lifeGuide.maps.length}} ä¸ªåœ°å›¾</text>
      </view>
      
      <view class="maps-grid-edit">
        <view class="map-card-edit" wx:for="{{lifeGuide.maps}}" wx:key="index">
          <view class="map-info-edit">
            <input class="map-name-input" 
                   value="{{item.name}}" 
                   bindinput="updateMapName" 
                   data-index="{{index}}"
                   placeholder="åœ°å›¾åç§°"/>
            <view class="image-upload">
              <image wx:if="{{item.image}}" src="{{item.image}}" mode="aspectFill" class="uploaded-image"/>
              <button class="btn-upload" bindtap="chooseImage" data-section="maps" data-index="{{index}}">
                {{item.image ? 'æ›´æ¢å›¾ç‰‡' : 'ä¸Šä¼ å›¾ç‰‡'}}
              </button>
              <button wx:if="{{item.image}}" class="btn-remove-image" bindtap="removeImage" data-section="maps" data-index="{{index}}">åˆ é™¤å›¾ç‰‡</button>
            </view>
          </view>
          <button class="remove-map-btn" 
                  bindtap="removeMap" 
                  data-index="{{index}}">
            ğŸ—‘ï¸
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- æµ·æ´‹è£…é¥° -->
  <view class="ocean-decoration">
    <view class="coral coral-1">ğŸª¸</view>
    <view class="coral coral-2">ğŸª¸</view>
    <view class="coral coral-3">ğŸª¸</view>
  </view>

  <!-- å¯†ç éªŒè¯å¼¹çª— -->
  <view class="auth-modal" wx:if="{{showPasswordModal}}">
    <view class="modal-overlay" bindtap="cancelPasswordAuth"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">ğŸ” ç®¡ç†å‘˜éªŒè¯</text>
      </view>
      <view class="modal-body">
        <text class="modal-desc">è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ä»¥éªŒè¯èº«ä»½</text>
        <view class="password-input-group">
          <input class="password-input" 
                 type="password" 
                 placeholder="è¯·è¾“å…¥å¯†ç " 
                 value="{{currentPassword}}"
                 bindinput="inputPassword" />
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn-cancel" bindtap="cancelPasswordAuth">å–æ¶ˆ</button>
        <button class="btn-confirm" bindtap="verifyPassword">éªŒè¯</button>
      </view>
    </view>
  </view>

  <!-- ä¿å­˜æé†’å¼¹çª— -->
  <view class="auth-modal" wx:if="{{showSaveReminderModal}}">
    <view class="modal-overlay" bindtap="cancelSaveReminder"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">ğŸ’¾ ä¿å­˜æé†’</text>
      </view>
      <view class="modal-body">
        <text class="modal-desc">æ‚¨æœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œæ˜¯å¦è¦ä¿å­˜ï¼Ÿ</text>
      </view>
      <view class="modal-footer">
        <button class="btn-cancel" bindtap="discardChanges">æ”¾å¼ƒæ›´æ”¹</button>
        <button class="btn-confirm" bindtap="confirmSave">ä¿å­˜</button>
      </view>
    </view>
  </view>


</view> 