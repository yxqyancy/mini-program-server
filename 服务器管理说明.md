# 微信小程序后端服务器管理说明

## 🎯 问题解决方案

### 问题描述
- 脚本无效，无法正确启动/停止服务器
- 服务器在关闭Cursor后停止运行
- 需要真正的后台运行解决方案
- 端口5000被占用导致启动失败
- 字符编码问题导致日志显示异常

### 最新解决方案
✅ **问题已解决！** 主要问题包括：

1. **端口占用问题**：之前的服务器进程没有完全停止，导致新启动失败
2. **字符编码问题**：日志文件中的中文字符显示异常
3. **进程管理问题**：启动脚本没有正确处理现有进程

**修复内容：**
- 创建了改进版启动脚本 `start-server-improved.bat`
- 创建了最终版启动脚本 `start-server-final.bat`（推荐使用）
- 修复了字符编码问题
- 改进了进程检测和停止逻辑
- 增强了错误处理和用户提示
- 使用纯英文标签避免编码问题

### 解决方案
提供了多种服务器管理方案，从简单到高级：

## 📁 脚本文件说明

### 基础管理脚本
1. **start-server-background.bat** - 后台启动服务器（原版）
2. **start-server-improved.bat** - 后台启动服务器（改进版）
3. **start-server-final.bat** - 后台启动服务器（最终版，推荐）
4. **stop-server.bat** - 停止服务器（普通权限）
5. **check-server.bat** - 检查服务器状态
6. **stop-server-admin.bat** - 停止服务器（管理员权限）

### 高级管理脚本
5. **install-as-service.bat** - 安装为Windows服务
6. **pm2-manager.bat** - PM2管理器

## 🚀 推荐使用方案

### 方案一：PM2服务管理（推荐）
**优点：**
- 真正的后台运行
- 开机自动启动
- 崩溃自动重启
- 完全独立于Cursor

**使用步骤：**
1. 右键点击 `install-as-service.bat` → "以管理员身份运行"
2. 按照提示完成安装
3. 使用 `PM2管理器.bat` 管理服务器

### 方案二：最终版后台启动（推荐日常使用）
**优点：**
- 简单易用
- 不需要管理员权限
- 有日志记录
- 自动处理端口冲突
- 完全修复字符编码问题
- 使用纯英文标签，兼容性最佳

**使用步骤：**
1. 双击 `start-server-final.bat` 启动
2. 双击 `stop-server.bat` 停止
3. 双击 `check-server.bat` 查看状态

## 📋 详细使用说明

### 启动服务器
```bash
# 方案一：PM2服务
双击 "PM2管理器.bat" → 选择 "1. 启动服务器"

# 方案二：最终版后台启动（推荐）
双击 "start-server-final.bat"

# 方案三：改进版后台启动
双击 "start-server-improved.bat"

# 方案四：原版后台启动
双击 "start-server-background.bat"
```

### 停止服务器
```bash
# 方案一：PM2服务
双击 "PM2管理器.bat" → 选择 "2. 停止服务器"

# 方案二：普通停止
双击 "停止服务器.bat"

# 方案二：强制停止（管理员权限）
右键 "停止服务器(管理员).bat" → "以管理员身份运行"
```

### 检查状态
```bash
# 方案一：PM2服务
双击 "PM2管理器.bat" → 选择 "4. 查看服务器状态"

# 方案二：基础检查
双击 "检查状态.bat"
```

### 查看日志
```bash
# 方案一：PM2服务
双击 "PM2管理器.bat" → 选择 "5. 查看服务器日志"

# 方案二：文件日志
查看 server.log 文件
```

## 🔧 故障排除

### 服务器无法启动
1. 检查Node.js是否安装：`node --version`
2. 检查依赖包：`npm install`
3. 检查端口5000是否被占用
4. 查看错误日志

### 服务器无法停止
1. 使用管理员权限版本：`stop-server-admin.bat`
2. 手动检查任务管理器
3. 重启电脑

### 权限问题
- 右键脚本 → "以管理员身份运行"
- 确保用户有足够权限

## 📱 小程序连接

### 服务器地址
- 本地访问：`http://localhost:5000`
- 局域网访问：`http://192.168.110.33:5000`

### 连接测试
1. 启动服务器
2. 在浏览器访问 `http://localhost:5000`
3. 应该看到服务器响应

## 💡 最佳实践

### 推荐配置
1. **使用PM2服务管理**（最稳定）
2. 将PM2管理器固定到任务栏
3. 定期检查服务器状态
4. 备份数据库文件

### 安全建议
1. 修改默认管理员密码
2. 定期更新依赖包
3. 监控服务器日志
4. 限制网络访问

## 🆘 紧急情况

### 服务器完全无法启动
1. 重启电脑
2. 重新安装Node.js
3. 删除node_modules，重新安装依赖
4. 检查防火墙设置

### 数据丢失
1. 检查 `data/app.json` 备份
2. 恢复数据库文件
3. 重新配置服务器

## 📞 技术支持

如果遇到问题：
1. 查看服务器日志
2. 检查错误信息
3. 尝试重启服务
4. 联系技术支持

---

**最后更新：** 2025年8月4日
**版本：** v2.0 